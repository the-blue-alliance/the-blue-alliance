{% extends "base.html" %}
{% import 'match_partials/match_table_macros.html' as mtm %}

{% block title %}{{event.name}} ({{event.year}}) - The Blue Alliance{% endblock %}

{% block meta_description %}Videos and match results for the {{event.year}} {{event.name}} FIRST Robotics Competition in {{event.location}}.{% endblock %}

{% block more_head_tags %}
  <meta property="og:title" content="{{event.year}} {{event.name}}" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://www.thebluealliance.com/event/{{event.key_name}}" />
  <meta property="og:image" content="http://www.thebluealliance.com/images/logo_square_200.png" />
  <meta property="og:description" content="Videos and match results for the {{event.year}} {{event.name}} FIRST Robotics Competition in {{event.location}}."/>
  <meta property="og:site_name" content="The Blue Alliance" />
  <meta property="og:location" content="{{event.location}}" />
  {% if event.start_date %}<meta property="og:start_time" content="{{event.start_date|strftime("%Y-%m-%d")}}" />
  {% else %}<meta property="og:start_time" content="{{event.year}}" />{% endif %}
  {% if event.end_date %}<meta property="og:end_time" content="{{event.end_date|strftime("%Y-%m-%d")}}" />{% endif %}
  {% if event.venue %}<meta property="og:fn" content="{{event.venue}}" />{% endif %}
{% endblock %}


{% block content %}
<div class="container" itemscope itemtype="http://data-vocabulary.org/Event">
  <div class="row">
    <div class="col-sm-12">
      {% if event.year == 2016 and event.event_type_enum == 3 %}
      <p class="pull-right"><a class="btn btn-primary" href="/event/{{event.key_name}}/insights"><span class="glyphicon glyphicon-align-left"></span> Advanced Insights</a></p>
      {% endif %}
      <p><a class="btn btn-default" href="/events/{{event.year}}"><span class="glyphicon glyphicon-chevron-left"></span> {{event.year}} Events</a></p>
      <h1 itemprop="summary">{{event.name}} {{event.year}}</h1>
      {% if district_name %}<blockquote><em>Part of the <a href="/events/{{district_abbrev}}/{{event.year}}">{{district_name}} District</a></em></blockquote>{% endif %}
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <a class="btn btn-success pull-right" href="/suggest/event/video?event_key={{event.key_name}}" target="_blank"><span class="glyphicon glyphicon-plus"></span> Add videos!</a>
      <p>
        {% if event.start_date %}
          <span class="glyphicon glyphicon-calendar"></span> <time itemprop="startDate" datetime="{{event.start_date.isoformat()}}">{{ event.start_date|strftime("%B %d") }}{% if event.start_date.date() != event.end_date.date() %}</time> to <time itemprop="endDate" datetime="{{event.end_date.isoformat()}}">{{ event.end_date|strftime("%B %d") }}{% endif %}, {{ event.end_date|strftime("%Y") }}</time>
        {% endif %}
        {% if event.location or event.venue_address_safe %}
          <br><span class="glyphicon glyphicon-map-marker"></span>
          {% if event.venue_address_safe %}
            <a href="http://maps.google.com/maps?q={{ event.venue_address_safe|urlencode }}" target="_blank">{{ event.venue_or_venue_from_address }}</a>{% if event.location %} in {{event.location}}{% endif %}
          {% else %}
            <a href="http://maps.google.com/maps?q={{ event.location|urlencode }}" target="_blank">{{event.location}}</a>
          {% endif %}
        {% endif %}
        {% if event.website %}<br><span class="glyphicon glyphicon-globe"></span> <a href="{{ event.website }}" title="{{ event.name }}" target="_blank">{{ event.website }}</a>{% endif %}
        {% if event.official %}{% if not event.website %}<br><span class="glyphicon glyphicon-info-sign"></span>{% else %} - {% endif %} details on <a href="http://www.firstinspires.org/team-event-search/event?id={{ event.first_eid }}" target="_blank">firstinspires.org</a>{% endif %}
        {% if event.facebook_eid %}<br><span class="glyphicon glyphicon-thumbs-up"></span> <a href="{{ event.facebook_event_url }}" title="Facebook Event" target="_blank">RSVP on Facebook</a><br>{% endif %}
      </p>

      <p><strong>#{{ event.hashtag }}</strong> <small><a href="/hashtags" rel="tooltip" title="What are hashtags?">?</a></small> - Search
        <a class="hashtag-link hashtag-twitter" href="https://twitter.com/search/%23{{ event.hashtag }}" target="_blank" title="Search Twitter">Twitter</a> &middot;
        <a class="hashtag-link hashtag-youtube" href="http://www.youtube.com/results?search_query=%23{{ event.hashtag }}+OR+%22{{ event.name|urlencode }}%22" target="_blank" title="Search YouTube">YouTube</a> &middot;
        <a class="hashtag-link hashtag-cd" href="http://www.chiefdelphi.com/media/photos/tags/{{ event.hashtag }}" target="_blank" title="Search Chief Delphi">Chief Delphi</a> &middot;
        <a class="hashtag-link hashtag-flickr" href="http://www.flickr.com/search/?q=%23{{ event.hashtag }}" target="_blank" title="Search Flickr">Flickr</a>
      </p>
    </div>
  </div>

  {% if event.now %}
  <div class="row">
    <div class="col-sm-12">
      <div class="panel panel-default">
        <div class="panel-heading">
          <div class="hidden-xs pull-right">
            {% if event.webcast %}
              <a class="btn btn-xs btn-success" href="{{event.gameday_url}}" target="_blank"><span class="glyphicon glyphicon-facetime-video"></span> Watch now</a>
            {% else %}
              <a class="btn btn-xs btn-default" href="/suggest/event/webcast?event_key={{event.key_name}}" target="_blank">Add webcast</a>
            {% endif %}
          </div>
          <h3 class="panel-title">Event in progress</h3>
        </div>
        <div class="clearfix"></div>

        {% if matches_upcoming %}
        <div class="col-sm-6">
          <h4>Upcoming Matches</h4>
          {{ mtm.upcoming_match_table(matches_upcoming) }}
        </div>
        {% endif %}
        {% if matches_recent %}
        <div class="col-sm-6">
          <h4>Recent Matches</h4>
          {{ mtm.recent_match_table(matches_recent) }}
        </div>
        {% endif %}
        <div class="clearfix"></div>
      </div>
    </div>
  </div>
  {% endif %}

  <div class="row">
    <div class="col-sm-12">
      <ul class="nav nav-tabs">
        {% if matches.num > 0 %}<li class="active"><a href="#results" data-toggle="tab">Results</a></li>{% endif %}
        {% if event.rankings %}<li><a href="#rankings" data-toggle="tab">Rankings</a></li>{% endif %}
        {% if awards %}<li><a href="#awards" data-toggle="tab">Awards</a></li>{% endif %}
        {% if district_points_sorted %}<li><a href="#district-points" data-toggle="tab">District Points</a></li>{% endif %}
        <li class="{% if matches.num == 0 %}active{% endif %}"><a href="#teams" data-toggle="tab">Teams <span class="badge">{{num_teams}}</span></a></li>
        {% if event_insights_qual or event_insights_playoff %}<li><a href="#event-insights" data-toggle="tab">Insights</a></li>{% endif %}
      </ul>
    </div>
  </div>

  <div class="tab-content">
    {% if matches.num > 0 %}
    <div class="tab-pane active" id="results">
      <div class="row">
        {% if matches.qm %}
        <div class="col-sm-6">
          <h3>Qualification Results</h3>
          {{mtm.qual_match_table(matches)}}
        </div>
        {% endif %}

        {% if matches.ef or matches.qf or matches.sf or matches.f %}
        <div class="col-sm-6">
          {% if matches.qm %}
          {% include "event_partials/event_alliances_table.html" %}
          {% endif %}

          <h3>{% if event.year >= 2015 %}Playoff{% else %}Elimination{% endif %} Results</h3>
          {{mtm.elim_match_table(matches)}}

          {% if matches.qm %}
            {% if matches.qf or matches.sf or matches.f %}
              {% if is_2015_playoff %}
                <h3>Playoff Advancement</h3>
                {% include "playoff_partials/playoff_table.html" %}
              {% else %}
                <h3>{% if event.year >= 2015 %}Playoff{% else %}Elimination{% endif %} Bracket</h3>
                {% include "bracket_partials/bracket_table.html" %}
              {% endif %}
            {% endif %}

            {% include "event_partials/event_opr_table.html" %}
          {% endif %}
        </div>
        {% else %}
          <div class="col-sm-6">
            {% include "event_partials/event_alliances_table.html" %}
            {% include "event_partials/event_opr_table.html" %}
          </div>
        {% endif %}

        {% if not matches.qm %}
        <div class="col-sm-6">
          {% include "event_partials/event_alliances_table.html" %}

          {% if matches.qf or matches.sf or matches.f %}
            {% if is_2015_playoff %}
              <h3>Playoff Advancement</h3>
              {% include "playoff_partials/playoff_table.html" %}
            {% else %}
              <h3>{% if event.year >= 2015 %}Playoff{% else %}Elimination{% endif %} Bracket</h3>
              {% include "bracket_partials/bracket_table.html" %}
            {% endif %}
          {% endif %}
        </div>
        {% endif %}
      </div>
      <div class="row">
        <div class="col-sm-12">
          <p><a class="btn btn-default" href="/contact"><span class="glyphicon glyphicon-upload"></span> Tell us about YouTube videos</a></p>
          <p><a class="btn btn-default" href="/event/{{ event.key_name }}/feed"><span class="glyphicon glyphicon-barcode"></span> Matches in RSS</a></p>
        </div>
      </div>
    </div>
    {% endif %}

    {% if event.rankings %}
    <div class="tab-pane" id="rankings">
      <div class="row">
        <div class="col-sm-8 col-sm-offset-2 col-md-offset-2 col-lg-offset-2">
          {% if event.official %}
            {% if event.year > 2014 %}
              <p>Data from <a href="http://frc-events.firstinspires.org/{{event.year}}/{{event.event_short}}/rankings" target="_blank"> <em>FIRST</em>'s event page</a>.</p>
            {% else %}
              <p>Data from <a href="http://www2.usfirst.org/{{event.year}}comp/events/{{event.event_short}}/rankings.html" target="_blank"> <em>FIRST</em>'s event page</a>.</p>
            {% endif %}
          {% endif %}
          <table class="table table-striped table-condensed table-center tablesorter" id="rankingsTable">
            <thead>
              <tr>
              {% for element in event.rankings.0 %}
                <th>{{ element }}</th>
              {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in event.rankings %}
              {% if not loop.first %}
              <tr>
                {% for element in row %}
                <td>
                  {% if loop.index0 == 1 %}
                    <a href="/team/{{ element }}/{{event.year}}">{{ element }}</a>
                  {% else %}
                    {{ element }}
                  {% endif %}
                </td>
                {% endfor %}
              </tr>
              {% endif %}
              {% endfor %}
            </tbody>
          </table>
          {% if event.year >= 2007 and event.year != 2015 %}<p><b>*</b>This column is calculated for your convenience by The Blue Alliance using data provided by <i>FIRST</i> and is not official.</p>{% endif %}
        </div>
      </div>
    </div>
    {% endif %}

    <div class="tab-pane {% if matches.num == 0 %}active{% endif %}" id="teams">
      <div class="row">
        {% if teams_a %}
        <div class="col-sm-6">
          <table class="table table-striped table-condensed table-center team-table">
            <thead>
              <tr><th>Team</th><th>Location</th><th>Image</th></tr>
            </thead>
            <tbody>
              {% for team, image_medias in teams_a %}
              <tr>
                <td>
                  <div class="team-name-container">
                    <div class="favorite-team-icon" data-team="{{team.key.id()}}">
                        <span class="favorite-team-icon-spacer"></span>
                        <span class="glyphicon glyphicon-star"></span>
                    </div>
                    <div class="team-name">
                      <a href="/team/{{ team.team_number }}/{{event.year}}">{{ team.team_number }}<br>{% if team.nickname %}{{ team.nickname }}{% else %}--{% endif %}</a>
                    </div>
                  </div>
                </td>
                <td>{% if team.location %}{{ team.location }}{% else %}--{% endif %}</td>
                <td>{% if image_medias %}{% set small_thumbnail = True %}{% include "media_partials/image_carousel_partial.html" %}{% else %}<a class="btn btn-success" href="/suggest/team/media?team_key={{team.key_name}}&year={{event.year}}" target="_blank"><span class="glyphicon glyphicon-plus"></span></a>{% endif %}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="col-sm-6">
          <p>No teams yet.</p>
        </div>
        {% endif %}
        {% if teams_b %}
        <div class="col-sm-6">
          <table class="table table-striped table-condensed table-center team-table">
            <thead>
              <tr><th>Team</th><th>Location</th><th>Image</th></tr>
            </thead>
            <tbody>
              {% for team, image_medias in teams_b %}
              <tr>
                <td>
                  <div class="team-name-container">
                    <div class="favorite-team-icon" data-team="{{team.key.id()}}">
                        <span class="favorite-team-icon-spacer"></span>
                        <span class="glyphicon glyphicon-star"></span>
                    </div>
                    <div class="team-name">
                      <a href="/team/{{ team.team_number }}/{{event.year}}">{{ team.team_number }}<br>{% if team.nickname %}{{ team.nickname }}{% else %}--{% endif %}</a>
                    </div>
                  </div>
                </td>
                <td>{% if team.location %}{{ team.location }}{% else %}--{% endif %}</td>
                <td>{% if image_medias %}{% set small_thumbnail = True %}{% include "media_partials/image_carousel_partial.html" %}{% else %}<a class="btn btn-success" href="/suggest/team/media?team_key={{team.key_name}}&year={{event.year}}" target="_blank"><span class="glyphicon glyphicon-plus"></span></a>{% endif %}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% endif %}
      </div>
    </div>

    {% if awards %}
    <div class="tab-pane" id="awards">
      <div class="row">
        <div class="col-sm-8 col-sm-offset-2 col-md-offset-2 col-lg-offset-2">
          <table class="table table-striped table-condensed">
            <thead>
              <tr>
                <th>Award</th>
                <th>Winner</th>
              </tr>
            </thead>
            <tbody>
              {% for award in awards %}
              {% for team_number, awardees in award.recipient_dict.items() %}
              {% for awardee in awardees %}
              <tr>
                <td>{{award.name_str}}</td>
                <td>
                {% if awardee %}
                  {{ awardee }}
                  {% if team_number %}(<a href="/team/{{team_number|digits}}/{{event.year}}">{{team_number}}</a>){% endif %}
                {% else %}
                  {% if team_number %}
                  <a href="/team/{{team_number|digits}}/{{event.year}}">{{team_number}}</a>
                  {% else %}
                  --
                  {% endif %}
                {% endif %}
                </td>
              </tr>
              {% endfor %}
              {% endfor %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    {% endif %}

    {% if district_points_sorted %}
    <div class="tab-pane" id="district-points">
      <div class="row">
        <div class="col-sm-8 col-sm-offset-2 col-md-offset-2 col-lg-offset-2">
          <table class="table table-striped table-condensed table-center">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Team</th>
                <th>Qual Points</th>
                <th>{% if event.year >= 2015 %}Playoff{% else %}Elim{% endif %} Points</th>
                <th>Alliance Points</th>
                <th>Award Points</th>
                <th>Total Points</th>
              </tr>
            </thead>
            <tbody>
              {% for team_key, breakdown in district_points_sorted %}
              <tr>
                <td>{{loop.index}}</td>
                <td><a href="/team/{{team_key|strip_frc}}/{{event.year}}">{{team_key|strip_frc}}</a></td>
                <td>{{breakdown.qual_points}}</td>
                <td>{{breakdown.elim_points}}</td>
                <td>{{breakdown.alliance_points}}</td>
                <td>{{breakdown.award_points}}</td>
                <td><strong>{{breakdown.total}}<strong></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <p>* Although points are calculated for all teams at this event, not all teams may receive points in the District Ranking System for this event.</p>
        </div>
      </div>
    </div>
    {% endif %}

    {% if event_insights_qual or event_insights_playoff %}
    <div class="tab-pane" id="event-insights">
      <div class="row">
        {% if event_insights_qual %}
        <div class="col-sm-6">
          <h2>Qualification</h2>
          {% set event_insights = event_insights_qual %}
          {% include event_insights_template %}
        </div>
        {% endif %}

        {% if event_insights_playoff %}
        <div class="col-sm-6">
          <h2>Playoff</h2>
          {% set event_insights = event_insights_playoff %}
          {% include event_insights_template %}
        </div>
        {% endif %}
      </div>
    </div>
    {% endif %}
</div>
{% endblock %}

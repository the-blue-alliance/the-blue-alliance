{% extends "admin/base.html" %}

{% block title %}{{district.key_name}}{% endblock %}

{% block content %}
<h1>{{district.year}} {{district.display_name}} District</h1>
<div class="btn-group">
  <a href="/admin/district/edit/{{district.key_name}}" class="btn btn-primary"><span class="glyphicon glyphicon-edit"></span>
    Edit</a>
  <a href="/events/{{district.abbreviation}}/{{district.year}}" class="btn btn-default"><span class="glyphicon glyphicon-eye-open"></span> View on
    TBA</a>
</div>
<hr/>

<div class="row">
  <div class="col-sm-12">
    <ul class="nav nav-tabs nav-justified">
      <li class="active"><a href="#info" data-toggle="tab">Info</a></li>
      <li><a href="#events" data-toggle="tab">Events</a></li>
      <li><a href="#rankings" data-toggle="tab">Rankings</a></li>
      <li><a href="#advancement" data-toggle="tab">Advancement</a></li>
      <li><a href="#adjustments" data-toggle="tab">HQ Adjustments</a></li>
    </ul>
  </div>
</div>

<div class="tab-content">
    <div class="tab-pane active" id="info">
        <table class="table table-striped table-hover">
            <tr>
                <td>Display Name</td>
                <td>{{ district.display_name }}</td>
            </tr>
            <tr>
                <td>Elasticsearch Name</td>
                <td> {{district.elasticsearch_name }}</td>
            </tr>
        </table>

        <h2>Tasks</h2>
        <div class="btn-group">
          <a href="/backend-tasks/get/district_rankings/{{district.key_name}}" class="btn btn-warning"><span class="glyphicon glyphicon-refresh"></span> Details from FIRST</a>
          <a href="/tasks/math/do/district_rankings_calc/{{district.key_name}}" class="btn btn-warning"><span class="glyphicon glyphicon-stats"></span> Recompute Rankings</a>
        </div>
    </div>
    <div class="tab-pane" id="events">
        <table class="table table-striped table-hover">
            <tr>
                <th>Event</th>
                <th>Has Points</th>
                <th></th>
            </tr>
            {% for event in events %}
                <tr>
                    <td><a href="/admin/event/{{event.key_name}}">{{event.name}}</a></td>
                    <td>
                        {% if event.details.district_points and event.details.district_points.points %}<span class="glyphicon glyphicon-ok"><span>{% endif %}
                    </td>
                    <td>
                        <a href="/tasks/math/do/district_points_calc/{{event.key_name}}" class="btn btn-warning"><span class="glyphicon glyphicon-tasks"></span> Compute District Points</a>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
    <div class="tab-pane" id="rankings">
        <table class="table table-striped table-hover">
            <tr>
                <th>Rank</th>
                <th>Team</th>
                <th>Point Total</th>
                <th>Rookie Bonus</th>
                <th>Adjustments</th>
                <th>Event Points</th>
            </tr>
            {% for rank in district.rankings or []%}
                <tr>
                    <td>{{rank.rank}}</td>
                    <td><a href="/admin/team/{{rank.team_key[3:]}}">{{rank.team_key}}</a></td>
                    <td>{{rank.point_total}}</td>
                    <td>{{rank.rookie_bonus}}</td>
                    <td>{% if rank.adjustments %}{{rank.adjustments}}{% endif %}</td>
                    <td><pre>{% if rank.event_points %}{{rank.event_points|pprint_json}}{%endif%}</pre></td>
                </tr>
            {% else %}
                <tr><td>No district rankings found</td></tr>
            {% endfor %}
        </table>
    </div>
    <div class="tab-pane" id="advancement">
        <table class="table table-striped table-hover">
            <tr>
                <td>Team</td>
                <td>Qualified for DCMP</td>
                <td>Qualified for CMP</td>
            </tr>
            {% for team_key, advancement in (district.advancement or {}).items() %}
                <tr>
                    <td><a href="/admin/team/{{team_key}}">{{team_key}}</a></td>
                    <td>{% if advancement.dcmp %}<span class="glyphicon glyphicon-ok"></span>{% endif %}</td>
                    <td>{% if advancement.cmp %}<span class="glyphicon glyphicon-ok"></span>{% endif %}</td>
                </tr>
            {% else %}
                <tr><td>No advancement found</td></tr>
            {% endfor %}
        </table>
    </div>
    <div class="tab-pane" id="adjustments">
        <table class="table table-stripled table-hover">
            <tr>
                <th>Team</th>
                <th>Adjustment</th>
            </tr>
            {% for team_key, adjustment in (district.adjustments or {}).items() %}
                <tr>
                    <td><a href="/admin/team/{{team_key}}">{{team_key}}</a></td>
                    <td>{{adjustment}}</td>
                </tr>
            {% endfor %}
        </table>
    </div>
</div>

{% endblock %}